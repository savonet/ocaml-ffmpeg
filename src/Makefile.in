# Copyright (C) 2005-2006 Savonet team
# pulseaudio bindings for OCaml.
#
# by Samuel Mimram and Romain Beauxis

OCAMLMAKEFILE = OCamlMakefile

OCAMLFIND = @OCAMLFIND@
OCAMLFIND_LDCONF = @OCAMLFIND_LDCONF@
OCAMLC = @OCAMLC@ -thread
SYSTEM_OCAMLC = @SYSTEM_OCAMLC@
OCAMLOPT = @OCAMLOPT@ -thread
OCAMLBEST = @OCAMLBEST@
OCAMLMKTOP = @OCAMLMKTOP@
OCAMLMKLIB = @OCAMLMKLIB@
OCAMLCP = @OCAMLCP@
OCAMLDEP = @OCAMLDEP@
OCAMLLEX = @OCAMLLEX@
OCAMLYACC = @OCAMLYACC@
OCAMLDOC = @OCAMLDOC@
AR = @AR@
LATEX = @LATEX@
DVIPS = @DVIPS@
PS2PDF = @PS2PDF@
OCAMLLIBPATH = @CAMLLIBPATH@

GEN_CODE_INCLUDE = @GEN_CODE_INCLUDE@

SOURCES = pixel_format.mli pixel_format.ml channel_layout.mli channel_layout.ml sample_format.mli sample_format.ml avutil_stubs.h avutil_stubs.c avutil.mli avutil.ml swscale_stubs.c swscale.mli swscale.ml avfilter_stubs.c avfilter.ml
ifeq "@HAS_AV@" "yes"
ifeq "@HAS_SWRESAMPLE@" "yes"
	SOURCES += avcodec_stubs.h avcodec_stubs.c codec_id.mli codec_id.ml avcodec.mli avcodec.ml
	SOURCES += av_stubs.c av.mli av.ml
	SOURCES += swresample_options.mli swresample_options.ml swresample_stubs.c swresample.mli swresample.ml
ifeq "@HAS_AVDEVICE@" "yes"
	SOURCES +=  avdevice_stubs.c avdevice.mli avdevice.ml
endif
endif
endif
RESULT = ffmpeg
LIB_PACK_NAME = FFmpeg
OCAMLDOCFLAGS = -stars -hide Avutil
LIBINSTALL_FILES = $(wildcard *.mli *.cmi *.cma *.cmxa *.cmx *.a *.so)
ACLIBS = @LIBS@
LDFLAGS = @LDFLAGS@
CLIBS = $(ACLIBS:-l%=%)
LIBDIRS = $(@LIBDIRS@:-L%=%)
CC = @CC@
CFLAGS = @CFLAGS@ -Wall -DCAML_NAME_SPACE
CPPFLAGS = @CPPFLAGS@
INCDIRS = @INC@
NO_CUSTOM = yes
OCAMLFLAGS = @OCAMLFLAGS@
PRE_TARGETS = gen-code
ANNOT_FLAG = -annot -bin-annot

all: $(OCAMLBEST)

byte: byte-code-library

opt: native-code-library

gen-code:
	$(SYSTEM_OCAMLC) -c gen_code_stubs.c
	$(SYSTEM_OCAMLC) -custom str.cma gen_code_stubs.o gen_code.ml -o gen_code
	./gen_code -I$(GEN_CODE_INCLUDE)

install: libinstall

uninstall: libuninstall

update: uninstall install

-include $(OCAMLMAKEFILE)
